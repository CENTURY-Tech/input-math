<link rel=import href=../../polymer/polymer.html><link rel=import href=../../polymer-ts/polymer-ts.html><link rel=import href=../../jquery/dist/jquery.min.html><script>!function(){function t(){}function e(t){var e=t.length-1;return function(){var n=q.call(arguments,0,e),i=q.call(arguments,e);return t.apply(this,n.concat([i]))}}function n(t){return e(function(e,n){"function"!=typeof e&&(e=y(e));var i=function(t){return e.apply(t,[t].concat(n))};return t.call(this,i)})}function i(t){var e=q.call(arguments,1);return function(){return t.apply(this,e)}}function s(t,e){if(!e)throw new Error("prayer failed: "+t)}function r(t){s("a direction was passed",t===k||t===j)}function o(t,e,n){s("a parent is always present",t),s("leftward is properly set up",function(){return e?e[j]===n&&e.parent===t:t.ends[k]===n}()),s("rightward is properly set up",function(){return n?n[k]===e&&n.parent===t:t.ends[j]===e}())}function a(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function l(t){return a(),It(t)}function c(e){function n(t){if(!t||!t.nodeType)return null;var e=Q(t).children(".mq-root-block").attr(b),n=e&&C.byId[e].controller;return n?s[n.KIND_OF_MQ](n):null}function i(t,e){e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:s});for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],r=z[n];t[n]=r?r(i):i}}if(!(e>=F&&$>=e))throw"Only interface versions between "+F+" and "+$+" supported. You specified: "+e;var s={};n.L=k,n.R=j,n.config=function(t){return i(I.p,t),this},n.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";B[t]=e};var r=s.AbstractMathQuill=O(M,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e=this.__controller,n=e.root,i=e.container;e.createTextarea();var s=i.addClass(t).contents().detach();n.jQ=Q('<span class="mq-root-block"/>').attr(b,n.id).appendTo(i),this.latex(s.text()),this.revert=function(){return i.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(s)}},t.config=function(t){return i(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}});n.prototype=r.prototype,s.EditableField=O(r,function(e,n){e.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.cmd=function(t){var e=this.__controller.notify(),n=e.cursor;if(/^\\[a-z]+$/i.test(t)){t=t.slice(1);var i=D[t];i&&(t=i(t),n.selection&&t.replaces(n.replaceSelection()),t.createLeftOf(n.show()),this.__controller.scrollHoriz())}else n.parent.write(n,t);return e.blurred&&n.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[k];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(k)},e.moveToRightEnd=function(){return this.moveToDirEnd(j)},e.keystroke=function(e){for(var e=e.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<e.length;n+=1)this.__controller.keystroke(e[n],{preventDefault:t});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},e.dropEmbedded=function(t,e,n){var i=t-Q(window).scrollLeft(),s=e-Q(window).scrollTop(),r=document.elementFromPoint(i,s);this.__controller.seek(Q(r),t,e);var o=xt().setOptions(n);o.createLeftOf(this.__controller.cursor)},e.clickAt=function(t,e,n){n=n||document.elementFromPoint(t,e);var i=this.__controller,s=i.root;return g.contains(s.jQ[0],n)||(n=s.jQ[0]),i.seek(Q(n),t+pageXOffset,e+pageYOffset),i.blurred&&this.focus(),this},e.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}}),n.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},n.EditableField.prototype=s.EditableField.prototype;for(var o in R)(function(t,i){var r=s[t]=i(s);n[t]=function(i,s){var o=n(i);if(o instanceof r||!i||!i.nodeType)return o;var a=A(r.RootBlock(),Q(i),I());return a.KIND_OF_MQ=t,r(a).__mathquillify(s,e)},n[t].prototype=r.prototype})(o,R[o]);return n}function u(t){for(var e="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),n=0;n<e.length;n+=1)(function(e){t[e]=function(t){this.controller.handle(e,t)}})(e[n]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function h(t,e,n){return O(J,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function f(t){var e=this.parent,n=t;do{if(n[j])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function p(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));it(this.delimjQs,w(1+.2*(t-1),1.2),1.2*t)}}function d(t,e){var e=e||t,n=bt[t],s=bt[e];S[t]=i(vt,k,t,n,e,s),S[n]=i(vt,j,t,n,e,s)}var m,g=window.jQuery,v="mathquill-command-id",b="mathquill-block-id",w=Math.min,x=Math.max,q=[].slice,y=e(function(t,n){return e(function(e,i){return t in e?e[t].apply(e,n.concat(i)):void 0})}),O=function(t,e,n){function i(t){return"object"==typeof t}function s(t){return"function"==typeof t}function r(){}return function o(a,l){function c(){var t=new u;return s(t.init)&&t.init.apply(t,arguments),t}function u(){}l===n&&(l=a,a=Object),c.Bare=u;var h,f=r[t]=a[t],p=u[t]=c[t]=c.p=new r;return p.constructor=c,c.mixin=function(e){return u[t]=c[t]=o(c,e)[t],c},(c.open=function(t){if(h={},s(t)?h=t.call(c,p,f,c,a):i(t)&&(h=t),i(h))for(var n in h)e.call(h,n)&&(p[n]=h[n]);return s(p.init)||(p.init=a),c})(l)}}("prototype",{}.hasOwnProperty),k=-1,j=1,Q=O(g,function(t){t.insDirOf=function(t,e){return t===k?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===k?this.prependTo(e):this.appendTo(e)}}),T=O(function(t){t.parent=0,t[k]=0,t[j]=0,t.init=function(t,e,n){this.parent=t,this[k]=e,this[j]=n},this.copy=function(t){return T(t.parent,t[k],t[j])}}),C=O(function(t){function e(){return i+=1}t[k]=0,t[j]=0,t.parent=0;var i=0;this.byId={},t.init=function(){this.id=e(),C.byId[this.id]=this,this.ends={},this.ends[k]=0,this.ends[j]=0},t.dispose=function(){delete C.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=Q(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){if(t.getAttribute){var n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id");n&&C.byId[n].jQadd(t),i&&C.byId[i].jQadd(t)}for(t=t.firstChild;t;t=t.nextSibling)e(t)}for(var t=Q(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){r(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[k],e[j]),n},t.createLeftOf=function(t){return this.createDir(k,t)},t.selectChildren=function(t,e){return E(t,e)},t.bubble=n(function(t){for(var e=this;e;e=e.parent){var n=t(e);if(n===!1)break}return this}),t.postOrder=n(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[k]&&0===this.ends[j]},t.children=function(){return _(this.ends[k],this.ends[j])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return _(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return _(this,this).adopt(t,e,n),this},t.disown=function(){return _(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),_=O(function(t){t.init=function(t,e,n){if(n===m&&(n=k),r(n),s("no half-empty fragments",!t==!e),this.ends={},t){s("withDir is passed to Fragment",t instanceof C),s("oppDir is passed to Fragment",e instanceof C),s("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=Q(),t.withDirAdopt=function(t,e,n,i){return t===k?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){o(t,e,n);var i=this;i.disowned=!1;var s=i.ends[k];if(!s)return this;var r=i.ends[j];return e||(t.ends[k]=s),n?n[k]=r:t.ends[j]=r,i.ends[j][j]=n,i.each(function(n){n[k]=e,n.parent=t,e&&(e[j]=n),e=n}),i},t.disown=function(){var t=this,e=t.ends[k];if(!e||t.disowned)return t;t.disowned=!0;var n=t.ends[j],i=e.parent;return o(i,e[k],e),o(i,n,n[j]),e[k]?e[k][j]=n[j]:i.ends[k]=n[j],n[j]?n[j][k]=e[k]:i.ends[j]=e[k],t},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=n(function(t){var e=this,n=e.ends[k];if(!n)return e;for(;n!==e.ends[j][j];n=n[j]){var i=t(n);if(i===!1)break}return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),D={},S={},L=O(T,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=Q('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[j]?this.jQ.insertBefore(this.selection&&this.selection.ends[k][k]===this[k]?this.selection.jQ:this[j].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=Q(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur(this)},t.insDirOf=function(t,e){return r(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(k,t)},t.insRightOf=function(t){return this.insDirOf(j,t)},t.insAtDirEnd=function(t,e){return r(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(k,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(j,t)},t.jumpUpDown=function(t,e){var n=this;n.upDownCache[t.id]=T.copy(n);var i=n.upDownCache[e.id];if(i)i[j]?n.insLeftOf(i[j]):n.insAtRightEnd(i.parent);else{var s=n.offset().left;e.seek(s,n)}},t.offset=function(){var t=this,e=t.jQ.removeClass("mq-cursor").offset();return t.jQ.addClass("mq-cursor"),e},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[j],i=this,s=t[k];if(t.disown().eachChild(function(i){i.isEmpty()||(i.children().adopt(e,s,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),s=i.ends[j])}),!this[j])if(this[k])this[j]=this[k][j];else for(;!this[j];){if(this.parent=this.parent[j],!this.parent){this[j]=t[j],this.parent=e;break}this[j]=this.parent.ends[k]}this[j]?this.insLeftOf(this[j]):this.insAtRightEnd(e),t.jQ.remove(),t[k].siblingDeleted&&t[k].siblingDeleted(i.options,j),t[j].siblingDeleted&&t[j].siblingDeleted(i.options,k)},t.startSelection=function(){for(var t=this.anticursor=T.copy(this),e=t.ancestors={},n=t;n.parent;n=n.parent)e[n.parent.id]=n},t.endSelection=function(){delete this.anticursor},t.select=function(){var t=this.anticursor;if(this[k]===t[k]&&this.parent===t.parent)return!1;for(var e=this;e.parent;e=e.parent)if(e.parent.id in t.ancestors){var n=e.parent;break}s("cursor and anticursor in the same tree",n);var i,r,o=t.ancestors[n.id],a=j;if(e[k]!==o)for(var l=e;l;l=l[j])if(l[j]===o[j]){a=k,i=e,r=o;break}return a===j&&(i=o,r=e),i instanceof T&&(i=i[j]),r instanceof T&&(r=r[k]),this.hide().selection=n.selectChildren(i,r),this.insDirOf(a,this.selection.ends[a]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[k]=this.selection.ends[k][k],this[j]=this.selection.ends[j][j],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[k]=t.ends[k][k],this[j]=t.ends[j][j],delete this.selection),t}}),E=O(_,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),A=O(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=L(t,n)},t.handle=function(t,e){var n=this.options.handlers;if(n&&n.fns[t]){var i=n.APIClasses[this.KIND_OF_MQ](this);e===k||e===j?n.fns[t](e,i):n.fns[t](i)}};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),R={},I=O(),z={},M=O(),B={};l.prototype=M.p,l.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return a=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},a(),l},l.getInterface=c;var F=c.MIN=1,$=c.MAX=2;l.noConflict=function(){return window.MathQuill=N,l};var N=window.MathQuill;window.MathQuill=l;var P=function(){function e(t){var e,i=t.which||t.keyCode,s=n[i],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=s||String.fromCharCode(i),r.length||s?(r.push(e),r.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function s(t){x=t,clearTimeout(d),d=setTimeout(t)}function r(e){x(),x=t,clearTimeout(d),b.val(e),e&&b[0].select&&b[0].select(),q=!!e}function o(){var t=b[0];return"selectionStart"in t?t.selectionStart!==t.selectionEnd:!1}function a(){i.keystroke(e(m),m)}function l(e){m=e,v=null,q&&s(function(e){e&&"focusout"===e.type||!b[0].select||b[0].select(),x=t,clearTimeout(d)}),a()}function c(t){m&&v&&a(),v=t,s(u)}function u(){if(!o()){var t=b.val();1===t.length?(b.val(""),i.typedText(t)):t&&b[0].select&&b[0].select()}}function h(){m=v=null}function f(t){b.focus(),s(p)}function p(){var t=b.val();b.val(""),t&&i.paste(t)}var d,m=null,v=null,b=g(n),w=g(i.container||b),x=t;w.bind("keydown keypress input keyup focusout paste",function(t){x(t)});var q=!1;return w.bind({keydown:l,keypress:c,focusout:h,paste:f}),{select:r}}}(),U=O(function(t,e,n){function i(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(a)._(""+t,e,i)},t.or=function(t){s("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){function r(e){return t._(n,i,s)}return e._(n,i,r)})},t.then=function(t){var e=this;return n(function(i,r,o){function a(e,i){var a=t instanceof n?t:t(i);return s("a parser is returned",a instanceof n),a._(e,r,o)}return e._(i,a,o)})},t.many=function(){var t=this;return n(function(e,n,i){function s(t,n){return e=t,o.push(n),!0}function r(){return!1}for(var o=[];t._(e,s,r););return n(e,o)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,r){function o(t,e){return u.push(e),n=t,!0}function a(t,e){return c=e,n=t,!1}function l(t,e){return!1}for(var c,u=[],h=!0,f=0;t>f;f+=1)if(h=i._(n,o,a),!h)return r(n,c);for(;e>f&&h;f+=1)h=i._(n,o,l);return s(n,u)})},t.result=function(t){return this.then(o(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return o(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})};var r=(this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,r){var o=n.slice(0,e);return o===t?s(n.slice(e),o):r(n,i)})},this.regex=function(t){s("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var r=t.exec(n);if(r){var o=r[0];return i(n.slice(o.length),o)}return s(n,e)})}),o=n.succeed=function(t){return n(function(e,n){return n(e,t)})},a=(n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=r(/^[a-z]/i),n.letters=r(/^[a-z]*/i),n.digit=r(/^[0-9]/),n.digits=r(/^[0-9]*/),n.whitespace=r(/^\s+/),n.optWhitespace=r(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)}))});A.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),r.selection&&r.selection.jQ.addClass("mq-blur"),e()}function e(){r.hide().parent.blur(),i.container.removeClass("mq-focused"),Q(window).off("blur",t)}var n,i=this,s=i.root,r=i.cursor;i.textarea.focus(function(){i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),r.parent||r.insAtRightEnd(s),r.selection?(r.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):r.show()}).blur(function(){i.blurred=!0,n=setTimeout(function(){s.postOrder("intentionalBlur"),r.clearSelection().endSelection(),e()}),Q(window).on("blur",t)}),i.blurred=!0,r.hide().parent.blur()}}),A.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),A.open(function(e){I.p.ignoreNextMousedown=t,e.delegateMouseEvents=function(){var e=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function i(t){p=Q(t.target)}function s(t){c.anticursor||c.startSelection(),l.seek(p,t.pageX,t.pageY).cursor.select(),p=m}function r(t){c.blink=u,c.selection||(l.editable?c.show():h.detach()),o.unbind("mousemove",i),Q(t.target.ownerDocument).unbind("mousemove",s).unbind("mouseup",r)}var o=Q(n.target).closest(".mq-root-block"),a=C.byId[o.attr(b)||e.attr(b)],l=a.controller,c=l.cursor,u=c.blink,h=l.textareaSpan,f=l.textarea;if(n.preventDefault(),n.target.unselectable=!0,!c.options.ignoreNextMousedown(n)){c.options.ignoreNextMousedown=t;var p;l.blurred&&(l.editable||o.prepend(h),f.focus()),c.blink=t,l.seek(Q(n.target),n.pageX,n.pageY).cursor.startSelection(),o.mousemove(i),Q(n.target.ownerDocument).mousemove(s).mouseup(r)}})}}),A.open(function(t){t.seek=function(t,e,n){var i=this.notify("select").cursor;if(t){var r=t.attr(b)||t.attr(v);if(!r){var o=t.parent();r=o.attr(b)||o.attr(v)}}var a=r?C.byId[r]:this.root;return s("nodeId is the id of some Node that exists",a),i.clearSelection().show(),a.seek(e,i),this.scrollHoriz(),this}}),A.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),C.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(k);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(j,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(k,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[j];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[j]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[k];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[k]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[k])for(;i[k];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[j])for(;i[j];)n.selectRight();else n.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(j);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[k];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){s("overridden or never called on this node")}}),A.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[j][i]?n.insAtLeftEnd(n[j][i]):n[k][i]?n.insAtRightEnd(n[k][i]):n.parent.bubble(function(t){var e=t[s];return e&&("function"==typeof e&&(e=t[s](n)),e instanceof C&&n.jumpUpDown(t,e),e!==!0)?!1:void 0}),t}this.onNotify(function(t){("move"===t||"upDown"===t)&&this.show().clearSelection()}),t.escapeDir=function(t,e,n){r(t);var i=this.cursor;return i.parent!==this.root&&n.preventDefault(),i.parent!==this.root?(i.parent.moveOutOf(t,i),this.notify("move")):void 0},z.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){r(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(k)},t.moveRight=function(){return this.moveDir(j)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){r(t);var e=this.cursor,n=e.selection;return this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[k].siblingDeleted&&e[k].siblingDeleted(e.options,j),e[j].siblingDeleted&&e[j].siblingDeleted(e.options,k),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){r(t);var e=this.cursor;return!e[k]||e.selection?ctrlr.deleteDir():(this.notify("edit"),_(e.parent.ends[k],e[k]).remove(),e.insAtDirEnd(k,e.parent),e[k].siblingDeleted&&e[k].siblingDeleted(e.options,j),e[j].siblingDeleted&&e[j].siblingDeleted(e.options,k),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(k)},t.deleteForward=function(){return this.deleteDir(j)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e=this.notify("select").cursor,n=e.selection;r(t),e.anticursor||e.startSelection();var i=e[t];i?n&&n.ends[t]===i&&e.anticursor[-t]!==i?i.unselectInto(t,e):i.selectTowards(t,e):e.parent.selectOutOf(t,e),e.clearSelection(),e.select()||e.show()},t.selectLeft=function(){return this.selectDir(k)},t.selectRight=function(){return this.selectDir(j)}}),A.open(function(t){I.p.substituteTextarea=function(){return Q("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t=this.textareaSpan=Q('<span class="mq-textarea"></span>'),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=Q(e).appendTo(t);var n=this;n.cursor.selectionChanged=function(){n.selectionChanged()},n.container.bind("copy",function(){n.setTextareaSelection()})},t.selectionChanged=function(){var t=this;rt(t.container[0]),t.textareaSelectionTimeout===m&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=m;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){s.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,s=e.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+e.exportLatex()+"$</span>"),e.blurred=!0,i.bind("cut paste",!1).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},t.editablesTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan,s=P(n,this);this.selectFn=function(t){s.select(t)},this.container.prepend(i).on("cut",function(n){e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})}),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}});var W=function(){function t(t){var e=Z();return t.adopt(e,0,0),e}function e(t){for(var e=t[0]||Z(),n=1;n<t.length;n+=1)t[n].children().adopt(e,e.ends[j],0);return e}var n=U.string,i=U.regex,s=U.letter,r=U.any,o=U.optWhitespace,a=U.succeed,l=U.fail,c=s.map(function(t){return Ot(t)}),u=i(/^[^${}\\_^]/).map(function(t){return Y(t)}),h=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(r))).then(function(t){var e=D[t];return e?e(t).parser():l("unknown command: \\"+t)}),f=h.or(c).or(u),p=n("{").then(function(){return m}).skip(n("}")),d=o.then(p.or(f.map(t))),m=d.many().map(e).skip(o),g=n("[").then(d.then(function(t){return"]"!==t.join("latex")?a(t):l()}).many().map(e).skip(o)).skip(n("]")),v=m;return v.block=d,v.optBlock=g,v}();A.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e=this.notify("edit").cursor,n=U.all,i=U.eof,s=W.skip(i).or(n.result(!1)).parse(t);if(s&&!s.isEmpty()){s.children().adopt(e.parent,e[k],e[j]);var r=s.jQize();r.insertBefore(e.jQ),e[k]=s.ends[j],s.finalizeInsert(e.options,e),s.ends[j][j].siblingCreated&&s.ends[j][j].siblingCreated(e.options,k),s.ends[k][k].siblingCreated&&s.ends[k][k].siblingCreated(e.options,j),e.parent.bubble("reflow")}return this},t.renderLatexMath=function(t){var e=this.root,n=this.cursor,i=U.all,s=U.eof,r=W.skip(s).or(i.result(!1)).parse(t);e.eachChild("postOrder","dispose"),e.ends[k]=e.ends[j]=0,r&&r.children().adopt(e,0,0);var o=e.jQ;if(r){var a=r.join("html");o.html(a),e.jQize(o.children()),e.finalizeInsert(n.options)}else o.empty();delete n.selection,n.insAtRightEnd(e)},t.renderLatexText=function(t){var e=this.root,n=this.cursor;e.jQ.children().slice(1).remove(),e.eachChild("postOrder","dispose"),e.ends[k]=e.ends[j]=0,delete n.selection,n.show().insAtRightEnd(e);var i=U.regex,s=U.string,r=U.eof,o=U.all,a=s("$").then(W).skip(s("$").or(r)).map(function(t){var e=et(n);e.createBlocks();var i=e.ends[k];return t.children().adopt(i,0,0),e}),l=s("\\$").result("$"),c=l.or(i(/^[^$]/)).map(Y),u=a.or(c).many(),h=u.skip(r).or(o.result(!1)).parse(t);if(h){for(var f=0;f<h.length;f+=1)h[f].adopt(e,e.ends[j],0);e.jQize().appendTo(e.jQ),e.finalizeInsert(n.options)}}}),A.open(function(t){t.scrollHoriz=function(){var t=this.cursor,e=t.selection,n=this.root.jQ[0].getBoundingClientRect();if(e){var i=e.jQ[0].getBoundingClientRect(),s=i.left-(n.left+20),r=i.right-(n.right-20);if(e.ends[k]===t[j])if(0>s)var o=s;else{if(!(r>0))return;if(i.left-r<n.left+20)var o=s;else var o=r}else if(r>0)var o=r;else{if(!(0>s))return;if(i.right-s>n.right-20)var o=r;else var o=s}}else{var a=t.jQ[0].getBoundingClientRect().left;if(a>n.right-20)var o=a-(n.right-20);else{if(!(a<n.left+20))return;var o=a-(n.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+o},100)}});var H=O(C,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[j].siblingCreated&&n[j].siblingCreated(t,k),n[k].siblingCreated&&n[k].siblingCreated(t,j),n.bubble("reflow")}}),G=O(H,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=W.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[j],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[k],0,0),i.jQ.appendTo(n.ends[k].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){for(var t=this,e=t.numBlocks(),n=t.blocks=Array(e),i=0;e>i;i+=1){var s=n[i]=Z();s.adopt(t,t.ends[j],0)}},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[k],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return E(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[k]=t.jQ.offset().left,e[j]=e[k]+t.jQ.outerWidth(),e}var i=this,s=n(i);if(t<s[k])return e.insLeftOf(i);if(t>s[j])return e.insRightOf(i);var r=s[k];i.eachChild(function(o){var a=n(o);return t<a[k]?(t-r<a[k]-t?o[k]?e.insAtRightEnd(o[k]):e.insLeftOf(i):e.insAtLeftEnd(o),!1):t>a[j]?void(o[j]?r=a[j]:s[j]-t<t-a[j]?e.insRightOf(i):e.insAtRightEnd(o)):(o.seek(t,e),!1)})},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t=this,e=t.blocks,n=" mathquill-command-id="+t.id,i=t.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);s("no unmatched angle brackets",i.join("")===this.htmlTemplate);for(var r=0,o=i[0];o;r+=1,o=i[r])if("/>"===o.slice(-2))i[r]=o.slice(0,-2)+n+"/>";else if("<"===o.charAt(0)){s("not an unmatched top-level close tag","/"!==o.charAt(1)),
i[r]=o.slice(0,-1)+n+">";var a=1;do r+=1,o=i[r],s("no missing close tags",o),"</"===o.slice(0,2)?a-=1:"<"===o.charAt(0)&&"/>"!==o.slice(-2)&&(a+=1);while(a>0)}return i.join("").replace(/>&(\d+)/g,function(t,n){return" mathquill-block-id="+e[n].id+">"+e[n].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),K=O(G,function(e,n){e.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},e.parser=function(){return U.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},e.deleteTowards=function(t,e){e[t]=this.remove()[t]},e.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),Y=O(K,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),X=O(K,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),Z=O(H,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[k]===this.ends[j]&&0!==this.ends[k]?this.ends[k].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?k:j,t,n))},t.moveOutOf=function(t,e,n){var i=n&&this.parent[n+"Into"];!i&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[j];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[k].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[k];return n.seek(t,e)},t.chToCmd=function(t){var e;return t.match(/^[a-eg-zA-Z]$/)?Ot(t):/^\d$/.test(t)?qt(t):(e=S[t]||D[t])?e(t):Y(t)},t.write=function(t,e){var n=this.chToCmd(e);t.selection&&n.replaces(t.replaceSelection()),n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});R.StaticMath=function(t){return O(t.AbstractMathQuill,function(e,n){this.RootBlock=Z,e.__mathquillify=function(){return n.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})};var V=O(Z,u);R.MathField=function(e){return O(e.EditableField,function(e,n){this.RootBlock=V,e.__mathquillify=function(e,i){return this.config(e),i>1&&(this.__controller.root.reflow=t),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})};var J=O(C,function(t,e){function n(t){t.jQ[0].normalize();var e=t.jQ[0].firstChild;if(e){s("only node in TextBlock span is Text node",3===e.nodeType);var n=tt(e.data);return n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof _?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[k]&&this.ends[k].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n=this;if(e.createLeftOf.call(this,t),n[j].siblingCreated&&n[j].siblingCreated(t.options,k),n[k].siblingCreated&&n[k].siblingCreated(t.options,j),n.bubble("reflow"),t.insAtRightEnd(n),n.replacedText)for(var i=0;i<n.replacedText.length;i+=1)n.write(t,n.replacedText.charAt(i))},t.parser=function(){var t=this,e=U.string,n=U.regex,i=U.optWhitespace;return i.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return 0===e.length?_():(tt(e).adopt(t,0,0),t)})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=G.prototype.selectTowards,t.deleteTowards=G.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){if(t.show().deleteSelection(),"$"!==n)t[k]?t[k].appendText(n):tt(n).createLeftOf(t);else if(this.isEmpty())t.insRightOf(this),Y("\\$","$").createLeftOf(t);else if(t[j])if(t[k]){var i=J(),s=this.ends[k];s.disown().jQ.detach(),s.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)}else t.insLeftOf(this);else t.insRightOf(this)},t.seek=function(t,e){e.hide();var i=n(this),s=this.jQ.width()/this.text.length,r=Math.round((t-this.jQ.offset().left)/s);0>=r?e.insAtLeftEnd(this):r>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(r));for(var o=t-e.show().offset().left,a=o&&0>o?k:j,l=a;e[a]&&o*l>0;)e[a].moveTowards(a,e),l=o,o=t-e.offset().left;if(-a*l>a*o&&e[-a].moveTowards(-a,e),e.anticursor){if(e.anticursor.parent===this){var c=e[k]&&e[k].text.length;if(this.anticursorPosition===c)e.anticursor=T.copy(e);else{if(this.anticursorPosition<c){var u=e[k].splitRight(this.anticursorPosition);e[k]=u}else var u=e[j].splitRight(this.anticursorPosition-c);e.anticursor=T(this,u[k],u)}}}else this.anticursorPosition=e[k]&&e[k].text.length},t.blur=function(t){Z.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[k]===this?t[k]=this[k]:t[j]===this&&(t[j]=this[j])):n(this))},t.focus=Z.prototype.focus}),tt=O(C,function(t,e){function n(t,e){return e.charAt(t===k?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=Q(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){r(e),e===j?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=tt(this.text.slice(t)).adopt(this.parent,this,this[j]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){r(t);var i=n(-t,this.text),s=this[-t];return s?s.insTextAtDirEnd(i,t):tt(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===j?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){r(t);var i=e.anticursor,s=n(-t,this.text);if(i[t]===this){var o=tt(s).createDir(t,e);i[t]=o,e.insDirOf(t,o)}else{var a=this[-t];if(a)a.insTextAtDirEnd(s,t);else{var o=tt(s).createDir(-t,e);o.jQ.insDirOf(-t,e.selection.jQ)}1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])}return this.deleteTowards(t,e)}});S.$=D.text=D.textnormal=D.textrm=D.textup=D.textmd=J,D.em=D.italic=D.italics=D.emph=D.textit=D.textsl=h("\\textit","i",'class="mq-text-mode"'),D.strong=D.bold=D.textbf=h("\\textbf","b",'class="mq-text-mode"'),D.sf=D.textsf=h("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),D.tt=D.texttt=h("\\texttt","span",'class="mq-monospace mq-text-mode"'),D.textsc=h("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),D.uppercase=h("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),D.lowercase=h("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var et=O(G,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[k].cursor=this.cursor,this.ends[k].write=function(t,e){"$"!==e?Z.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),Y("\\$","$").createLeftOf(t.show())):t[j]?t[k]?Z.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[k].latex()+"$"}}),nt=O(V,function(t,e){t.keystroke=function(t){return"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):void 0},t.write=function(t,e){if(t.show().deleteSelection(),"$"===e)et(t).createLeftOf(t);else{var n;"<"===e?n="&lt;":">"===e&&(n="&gt;"),Y(e,n).createLeftOf(t)}}});R.TextField=function(t){return O(t.EditableField,function(t,e){this.RootBlock=nt,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})};var it,st,rt=(S["\\"]=O(G,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[k].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[k].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[k].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?Y(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))},this.ends[k].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return Q(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[k].latex()+" "},t.renderCommand=function(t){this.jQ=this.jQ.last(),this.remove(),this[j]?t.insLeftOf(this[j]):t.insAtRightEnd(this.parent);var e=this.ends[k].latex();e||(e=" ");var n=D[e];n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):(n=J(),n.replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}),t),ot=document.createElement("div"),at=ot.style,lt={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(var ct in lt)if(ct in at){st=ct;break}st?it=function(t,e,n){t.css(st,"scale("+e+","+n+")")}:"filter"in at?(rt=function(t){t.className=t.className},it=function(t,e,n){function i(){t.css("marginRight",(s.width()-1)*(e-1)/e+"px")}e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var s=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");i();var r=setInterval(i);Q(window).load(function(){clearTimeout(r),i()})}):it=function(t,e,n){t.css("fontSize",n+"em")};var ut=O(G,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}});D.mathrm=i(ut,"\\mathrm","span",'class="mq-roman mq-font"'),D.mathit=i(ut,"\\mathit","i",'class="mq-font"'),D.mathbf=i(ut,"\\mathbf","b",'class="mq-font"'),D.mathsf=i(ut,"\\mathsf","span",'class="mq-sans-serif mq-font"'),D.mathtt=i(ut,"\\mathtt","span",'class="mq-monospace mq-font"'),D.underline=i(ut,"\\underline","span",'class="mq-non-leaf mq-underline"'),D.overline=D.bar=i(ut,"\\overline","span",'class="mq-non-leaf mq-overline"'),D.overrightarrow=i(ut,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),D.overleftarrow=i(ut,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"');var ht=(D.textcolor=O(G,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=U.optWhitespace,i=U.string,s=U.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})}}),D["class"]=O(G,function(t,e){t.parser=function(){var t=this,n=U.string,i=U.regex;return U.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})}}),O(G,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){return t[k]||!t.options.supSubsRequireOperand?e.createLeftOf.apply(this,arguments):void 0},t.contactWeld=function(t){for(var e=k;e;e=e===k?j:!1)if(this[e]instanceof ht){for(var n="sub";n;n="sub"===n?"sup":!1){var i=this[n],s=this[e][n];if(i){if(s)if(i.isEmpty())var r=T(s,0,s.ends[k]);else{i.jQ.children().insAtDirEnd(-e,s.jQ);var o=i.children().disown(),r=T(s,o.ends[j],s.ends[k]);e===k?o.adopt(s,s.ends[j],0):o.adopt(s,0,s.ends[k])}else this[e].addBlock(i.disown());this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i)}}this.remove(),t&&t[k]===this&&(e===j&&r?r[k]?t.insRightOf(r[k]):t.insAtLeftEnd(r.parent):t.insRightOf(this[e]));break}this.respace()},I.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[k].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e);return n instanceof K?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[k]&&!t[j]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),Z.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof K?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(k,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.respace=t.siblingCreated=t.siblingDeleted=function(t,e){e!==j&&this.jQ.toggleClass("mq-limit","\\int "===this[k].ctrlSeq)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=Q('<span class="mq-sup"/>').append(t.jQ.children()).attr(b,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=Q('<span class="mq-sub"></span>').append(t.jQ.children()).attr(b,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;2>e;e+=1)(function(t,e,n,i){t[e].deleteOutOf=function(s,r){if(r.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var o=this.ends[s];this.children().disown().withDirAdopt(s,r.parent,r[s],r[-s]).jQ.insDirOf(-s,r.jQ),r[-s]=o}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=f,delete t[n].deleteOutOf,"sub"===e&&Q(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}})(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}));D.subscript=D._=O(ht,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[k],this.sub.upOutOf=f,e.finalizeTree.call(this)}}),D.superscript=D.supscript=D["^"]=O(ht,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[j],this.sup.downOutOf=f,e.finalizeTree.call(this)}});var ft=O(G,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';K.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(Ot("n").createLeftOf(t),Rt().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[k].latex())+"^"+t(this.ends[j].latex())},t.parser=function(){for(var t=U.string,e=U.optWhitespace,n=U.succeed,i=W.block,s=this,r=s.blocks=[Z(),Z()],o=0;o<r.length;o+=1)r[o].adopt(s,s.ends[j],0);return e.then(t("_").or(t("^"))).then(function(t){var e=r["_"===t?0:1];return i.then(function(t){return t.children().adopt(e,e.ends[j],0),n(s)})}).many().result(s)},t.finalizeTree=function(){this.downInto=this.ends[k],this.upInto=this.ends[j],this.ends[k].upOutOf=this.ends[j],this.ends[j].downOutOf=this.ends[k]}});D["∑"]=D.sum=D.summation=i(ft,"\\sum ","&sum;"),D["∏"]=D.prod=D.product=i(ft,"\\prod ","&prod;"),D.coprod=D.coproduct=i(ft,"\\coprod ","&#8720;"),D["∫"]=D["int"]=D.integral=i(K,"\\int ","<big>&int;</big>");var pt=D.frac=D.dfrac=D.cfrac=D.fraction=O(G,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[j].upOutOf=this.ends[k],this.downInto=this.ends[k].downOutOf=this.ends[j]}}),dt=D.over=S["/"]=O(pt,function(e,n){e.createLeftOf=function(e){if(!this.replacedFragment){for(var i=e[k];i&&!(i instanceof X||i instanceof(D.text||t)||i instanceof ft||"\\ "===i.ctrlSeq||/^[,;:]$/.test(i.ctrlSeq));)i=i[k];i instanceof ft&&i[j]instanceof ht&&(i=i[j],i[j]instanceof ht&&i[j].ctrlSeq!=i.ctrlSeq&&(i=i[j])),i!==e[k]&&(this.replaces(_(i[j]||e.parent.ends[k],e[k])),e[k]=i)}n.createLeftOf.call(this,e)}}),mt=D.sqrt=D["√"]=O(G,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return W.optBlock.then(function(t){return W.block.map(function(e){var n=gt();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[j].jQ;it(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),gt=(D.vec=O(G,function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),D.nthroot=O(mt,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[k].latex()+"]{"+this.ends[j].latex()+"}"}})),vt=O(O(G,p),function(e,n){e.init=function(t,e,i,s,r){n.init.call(this,"\\left"+s,m,[e,i]),this.side=t,this.sides={},this.sides[k]={ch:e,ctrlSeq:s},this.sides[j]={ch:i,ctrlSeq:r}},e.numBlocks=function(){return 1},e.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===j?" mq-ghost":"")+'">'+this.sides[k].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===k?" mq-ghost":"")+'">'+this.sides[j].ch+"</span></span>",n.html.call(this)},e.latex=function(){return"\\left"+this.sides[k].ctrlSeq+this.ends[k].latex()+"\\right"+this.sides[j].ctrlSeq},e.oppBrack=function(t,e,n){return e instanceof vt&&e.side&&e.side!==-n&&("|"===this.sides[this.side].ch||e.side===-this.side)&&(!t.restrictMismatchedBrackets||bt[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[k].ch]===e.sides[j].ch)&&e},e.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===k?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},e.createLeftOf=function(t){if(!this.replacedFragment)var e=t.options,i=this.oppBrack(e,t[k],k)||this.oppBrack(e,t[j],j)||this.oppBrack(e,t.parent.parent);if(i){var s=this.side=-i.side;this.closeOpposing(i),i===t.parent.parent&&t[s]&&(_(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,i.parent,i,i[s]).jQ.insDirOf(s,i.jQ),i.bubble("reflow"))}else i=this,s=i.side,i.replacedFragment?i.side=0:t[-s]&&(i.replaces(_(t[-s],t.parent.ends[-s],s)),t[-s]=0),n.createLeftOf.call(i,t);s===k?t.insAtLeftEnd(i.ends[k]):t.insRightOf(i)},e.placeCursor=t,e.unwrap=function(){this.ends[k].children().disown().adopt(this.parent,this,this[j]).jQ.insertAfter(this.jQ),this.remove()},e.deleteSide=function(t,e,n){var i=this.parent,s=this[t],r=i.ends[t];if(t===this.side)return this.unwrap(),void(s?n.insDirOf(-t,s):n.insAtDirEnd(t,i));var o=n.options,a=!this.side;if(this.side=-t,this.oppBrack(o,this.ends[k].ends[this.side],t)){this.closeOpposing(this.ends[k].ends[this.side]);var l=this.ends[k].ends[t];this.unwrap(),l.siblingCreated&&l.siblingCreated(n.options,t),s?n.insDirOf(-t,s):n.insAtDirEnd(t,i)}else{if(this.oppBrack(o,this.parent.parent,t))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&a)return this.unwrap(),void(s?n.insDirOf(-t,s):n.insAtDirEnd(t,i));this.sides[t]={ch:bt[this.sides[this.side].ch],ctrlSeq:bt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===k?0:1).addClass("mq-ghost").html(this.sides[t].ch)}if(s){var l=this.ends[k].ends[t];_(s,r,-t).disown().withDirAdopt(-t,this.ends[k],l,0).jQ.insAtDirEnd(t,this.ends[k].jQ.removeClass("mq-empty")),l.siblingCreated&&l.siblingCreated(n.options,t),n.insDirOf(-t,s)}else e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[k])}},e.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},e.finalizeTree=function(){this.ends[k].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===k?1:0).removeClass("mq-ghost"),this.side=0}},e.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),bt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"};d("("),d("["),d("{","\\{"),D.langle=i(vt,k,"&lang;","&rang;","\\langle ","\\rangle "),D.rangle=i(vt,j,"&lang;","&rang;","\\langle ","\\rangle "),S["|"]=i(vt,k,"|","|","|","|"),D.left=O(G,function(t){t.parser=function(){var t=U.regex,e=U.string,n=(U.succeed,U.optWhitespace);return n.then(t(/^(?:[([|]|\\\{)/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return W.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\})/)).map(function(t){var e="\\"===t.charAt(0)?t.slice(1):t,n=vt(0,s,e,i,t);return n.blocks=[r],r.adopt(n,0,0),n})})})}}),D.right=O(G,function(t){t.parser=function(){return U.fail("unmatched \\right")}});var wt=D.binom=D.binomial=O(O(G,p),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]});D.choose=O(wt,function(t){t.createLeftOf=dt.prototype.createLeftOf});D.editable=D.MathQuillMathField=O(G,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=U.string,i=U.regex,s=U.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(){var t=A(this.ends[k],this.jQ,I());t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),u(t.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[k].controller))},t.latex=function(){return this.ends[k].latex()},t.text=function(){return this.ends[k].text()}});var xt=D.embed=O(K,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this;return string=U.string,regex=U.regex,succeed=U.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(e){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(n){return t.setOptions(B[e](n))})})}});D.notin=D.cong=D.equiv=D.oplus=D.otimes=O(X,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),D["≠"]=D.ne=D.neq=i(X,"\\ne ","&ne;"),D.ast=D.star=D.loast=D.lowast=i(X,"\\ast ","&lowast;"),D.therefor=D.therefore=i(X,"\\therefore ","&there4;"),D.cuz=D.because=i(X,"\\because ","&#8757;"),D.prop=D.propto=i(X,"\\propto ","&prop;"),D["≈"]=D.asymp=D.approx=i(X,"\\approx ","&asymp;"),D.isin=D["in"]=i(X,"\\in ","&isin;"),D.ni=D.contains=i(X,"\\ni ","&ni;"),D.notni=D.niton=D.notcontains=D.doesnotcontain=i(X,"\\not\\ni ","&#8716;"),D.sub=D.subset=i(X,"\\subset ","&sub;"),D.sup=D.supset=D.superset=i(X,"\\supset ","&sup;"),D.nsub=D.notsub=D.nsubset=D.notsubset=i(X,"\\not\\subset ","&#8836;"),D.nsup=D.notsup=D.nsupset=D.notsupset=D.nsuperset=D.notsuperset=i(X,"\\not\\supset ","&#8837;"),D.sube=D.subeq=D.subsete=D.subseteq=i(X,"\\subseteq ","&sube;"),D.supe=D.supeq=D.supsete=D.supseteq=D.supersete=D.superseteq=i(X,"\\supseteq ","&supe;"),D.nsube=D.nsubeq=D.notsube=D.notsubeq=D.nsubsete=D.nsubseteq=D.notsubsete=D.notsubseteq=i(X,"\\not\\subseteq ","&#8840;"),D.nsupe=D.nsupeq=D.notsupe=D.notsupeq=D.nsupsete=D.nsupseteq=D.notsupsete=D.notsupseteq=D.nsupersete=D.nsuperseteq=D.notsupersete=D.notsuperseteq=i(X,"\\not\\supseteq ","&#8841;"),D.N=D.naturals=D.Naturals=i(Y,"\\mathbb{N}","&#8469;"),D.P=D.primes=D.Primes=D.projective=D.Projective=D.probability=D.Probability=i(Y,"\\mathbb{P}","&#8473;"),D.Z=D.integers=D.Integers=i(Y,"\\mathbb{Z}","&#8484;"),D.Q=D.rationals=D.Rationals=i(Y,"\\mathbb{Q}","&#8474;"),D.R=D.reals=D.Reals=i(Y,"\\mathbb{R}","&#8477;"),D.C=D.complex=D.Complex=D.complexes=D.Complexes=D.complexplane=D.Complexplane=D.ComplexPlane=i(Y,"\\mathbb{C}","&#8450;"),D.H=D.Hamiltonian=D.quaternions=D.Quaternions=i(Y,"\\mathbb{H}","&#8461;"),D.quad=D.emsp=i(Y,"\\quad ","    "),D.qquad=i(Y,"\\qquad ","        "),D.diamond=i(Y,"\\diamond ","&#9671;"),D.bigtriangleup=i(Y,"\\bigtriangleup ","&#9651;"),D.ominus=i(Y,"\\ominus ","&#8854;"),D.uplus=i(Y,"\\uplus ","&#8846;"),D.bigtriangledown=i(Y,"\\bigtriangledown ","&#9661;"),D.sqcap=i(Y,"\\sqcap ","&#8851;"),D.triangleleft=i(Y,"\\triangleleft ","&#8882;"),D.sqcup=i(Y,"\\sqcup ","&#8852;"),D.triangleright=i(Y,"\\triangleright ","&#8883;"),D.odot=D.circledot=i(Y,"\\odot ","&#8857;"),D.bigcirc=i(Y,"\\bigcirc ","&#9711;"),D.dagger=i(Y,"\\dagger ","&#0134;"),D.ddagger=i(Y,"\\ddagger ","&#135;"),D.wr=i(Y,"\\wr ","&#8768;"),D.amalg=i(Y,"\\amalg ","&#8720;"),D.models=i(Y,"\\models ","&#8872;"),D.prec=i(Y,"\\prec ","&#8826;"),D.succ=i(Y,"\\succ ","&#8827;"),D.preceq=i(Y,"\\preceq ","&#8828;"),D.succeq=i(Y,"\\succeq ","&#8829;"),D.simeq=i(Y,"\\simeq ","&#8771;"),D.mid=i(Y,"\\mid ","&#8739;"),D.ll=i(Y,"\\ll ","&#8810;"),D.gg=i(Y,"\\gg ","&#8811;"),D.parallel=i(Y,"\\parallel ","&#8741;"),D.nparallel=i(Y,"\\nparallel ","&#8742;"),D.bowtie=i(Y,"\\bowtie ","&#8904;"),D.sqsubset=i(Y,"\\sqsubset ","&#8847;"),D.sqsupset=i(Y,"\\sqsupset ","&#8848;"),D.smile=i(Y,"\\smile ","&#8995;"),D.sqsubseteq=i(Y,"\\sqsubseteq ","&#8849;"),D.sqsupseteq=i(Y,"\\sqsupseteq ","&#8850;"),D.doteq=i(Y,"\\doteq ","&#8784;"),D.frown=i(Y,"\\frown ","&#8994;"),D.vdash=i(Y,"\\vdash ","&#8870;"),D.dashv=i(Y,"\\dashv ","&#8867;"),D.nless=i(Y,"\\nless ","&#8814;"),D.ngtr=i(Y,"\\ngtr ","&#8815;"),D.longleftarrow=i(Y,"\\longleftarrow ","&#8592;"),D.longrightarrow=i(Y,"\\longrightarrow ","&#8594;"),D.Longleftarrow=i(Y,"\\Longleftarrow ","&#8656;"),D.Longrightarrow=i(Y,"\\Longrightarrow ","&#8658;"),D.longleftrightarrow=i(Y,"\\longleftrightarrow ","&#8596;"),D.updownarrow=i(Y,"\\updownarrow ","&#8597;"),D.Longleftrightarrow=i(Y,"\\Longleftrightarrow ","&#8660;"),D.Updownarrow=i(Y,"\\Updownarrow ","&#8661;"),D.mapsto=i(Y,"\\mapsto ","&#8614;"),D.nearrow=i(Y,"\\nearrow ","&#8599;"),D.hookleftarrow=i(Y,"\\hookleftarrow ","&#8617;"),D.hookrightarrow=i(Y,"\\hookrightarrow ","&#8618;"),D.searrow=i(Y,"\\searrow ","&#8600;"),D.leftharpoonup=i(Y,"\\leftharpoonup ","&#8636;"),D.rightharpoonup=i(Y,"\\rightharpoonup ","&#8640;"),D.swarrow=i(Y,"\\swarrow ","&#8601;"),D.leftharpoondown=i(Y,"\\leftharpoondown ","&#8637;"),D.rightharpoondown=i(Y,"\\rightharpoondown ","&#8641;"),D.nwarrow=i(Y,"\\nwarrow ","&#8598;"),D.ldots=i(Y,"\\ldots ","&#8230;"),D.cdots=i(Y,"\\cdots ","&#8943;"),D.vdots=i(Y,"\\vdots ","&#8942;"),D.ddots=i(Y,"\\ddots ","&#8945;"),D.surd=i(Y,"\\surd ","&#8730;"),D.triangle=i(Y,"\\triangle ","&#9651;"),D.ell=i(Y,"\\ell ","&#8467;"),D.top=i(Y,"\\top ","&#8868;"),D.flat=i(Y,"\\flat ","&#9837;"),D.natural=i(Y,"\\natural ","&#9838;"),D.sharp=i(Y,"\\sharp ","&#9839;"),D.wp=i(Y,"\\wp ","&#8472;"),D.bot=i(Y,"\\bot ","&#8869;"),D.clubsuit=i(Y,"\\clubsuit ","&#9827;"),D.diamondsuit=i(Y,"\\diamondsuit ","&#9826;"),D.heartsuit=i(Y,"\\heartsuit ","&#9825;"),D.spadesuit=i(Y,"\\spadesuit ","&#9824;"),D.parallelogram=i(Y,"\\parallelogram ","&#9649;"),D.square=i(Y,"\\square ","&#11036;"),D.oint=i(Y,"\\oint ","&#8750;"),D.bigcap=i(Y,"\\bigcap ","&#8745;"),D.bigcup=i(Y,"\\bigcup ","&#8746;"),D.bigsqcup=i(Y,"\\bigsqcup ","&#8852;"),D.bigvee=i(Y,"\\bigvee ","&#8744;"),D.bigwedge=i(Y,"\\bigwedge ","&#8743;"),D.bigodot=i(Y,"\\bigodot ","&#8857;"),D.bigotimes=i(Y,"\\bigotimes ","&#8855;"),D.bigoplus=i(Y,"\\bigoplus ","&#8853;"),D.biguplus=i(Y,"\\biguplus ","&#8846;"),D.lfloor=i(Y,"\\lfloor ","&#8970;"),D.rfloor=i(Y,"\\rfloor ","&#8971;"),D.lceil=i(Y,"\\lceil ","&#8968;"),D.rceil=i(Y,"\\rceil ","&#8969;"),D.opencurlybrace=D.lbrace=i(Y,"\\lbrace ","{"),D.closecurlybrace=D.rbrace=i(Y,"\\rbrace ","}"),D.lbrack=i(Y,"["),D.rbrack=i(Y,"]"),D.slash=i(Y,"/"),D.vert=i(Y,"|"),D.perp=D.perpendicular=i(Y,"\\perp ","&perp;"),D.nabla=D.del=i(Y,"\\nabla ","&nabla;"),D.hbar=i(Y,"\\hbar ","&#8463;"),D.AA=D.Angstrom=D.angstrom=i(Y,"\\text\\AA ","&#8491;"),D.ring=D.circ=D.circle=i(Y,"\\circ ","&#8728;"),D.bull=D.bullet=i(Y,"\\bullet ","&bull;"),D.setminus=D.smallsetminus=i(Y,"\\setminus ","&#8726;"),D.not=D["¬"]=D.neg=i(Y,"\\neg ","&not;"),D["…"]=D.dots=D.ellip=D.hellip=D.ellipsis=D.hellipsis=i(Y,"\\dots ","&hellip;"),D.converges=D.darr=D.dnarr=D.dnarrow=D.downarrow=i(Y,"\\downarrow ","&darr;"),D.dArr=D.dnArr=D.dnArrow=D.Downarrow=i(Y,"\\Downarrow ","&dArr;"),D.diverges=D.uarr=D.uparrow=i(Y,"\\uparrow ","&uarr;"),
D.uArr=D.Uparrow=i(Y,"\\Uparrow ","&uArr;"),D.to=i(X,"\\to ","&rarr;"),D.rarr=D.rightarrow=i(Y,"\\rightarrow ","&rarr;"),D.implies=i(X,"\\Rightarrow ","&rArr;"),D.rArr=D.Rightarrow=i(Y,"\\Rightarrow ","&rArr;"),D.gets=i(X,"\\gets ","&larr;"),D.larr=D.leftarrow=i(Y,"\\leftarrow ","&larr;"),D.impliedby=i(X,"\\Leftarrow ","&lArr;"),D.lArr=D.Leftarrow=i(Y,"\\Leftarrow ","&lArr;"),D.harr=D.lrarr=D.leftrightarrow=i(Y,"\\leftrightarrow ","&harr;"),D.iff=i(X,"\\Leftrightarrow ","&hArr;"),D.hArr=D.lrArr=D.Leftrightarrow=i(Y,"\\Leftrightarrow ","&hArr;"),D.Re=D.Real=D.real=i(Y,"\\Re ","&real;"),D.Im=D.imag=D.image=D.imagin=D.imaginary=D.Imaginary=i(Y,"\\Im ","&image;"),D.part=D.partial=i(Y,"\\partial ","&part;"),D.infty=D.infin=D.infinity=i(Y,"\\infty ","&infin;"),D.alef=D.alefsym=D.aleph=D.alephsym=i(Y,"\\aleph ","&alefsym;"),D.xist=D.xists=D.exist=D.exists=i(Y,"\\exists ","&exist;"),D.nexists=D.nexist=i(Y,"\\nexists ","&#8708;"),D.and=D.land=D.wedge=i(Y,"\\wedge ","&and;"),D.or=D.lor=D.vee=i(Y,"\\vee ","&or;"),D.o=D.O=D.empty=D.emptyset=D.oslash=D.Oslash=D.nothing=D.varnothing=i(X,"\\varnothing ","&empty;"),D.cup=D.union=i(X,"\\cup ","&cup;"),D.cap=D.intersect=D.intersection=i(X,"\\cap ","&cap;"),D.deg=D.degree=i(Y,"\\degree ","&deg;"),D.ang=D.angle=i(Y,"\\angle ","&ang;"),D.measuredangle=i(Y,"\\measuredangle ","&#8737;");var qt=O(Y,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[k]instanceof yt&&t[k].isItalic!==!1||t[k]instanceof ht&&t[k][k]instanceof yt&&t[k][k].isItalic!==!1)?(D._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),yt=O(K,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[k]||this[k]instanceof yt||this[k]instanceof X||"\\ "===this[k].ctrlSeq||(t="*"+t),!this[j]||this[j]instanceof X||this[j]instanceof ht||(t+="*"),t}});I.p.autoCommands={_maxLength:0},z.autoCommands=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){var r=e[s];if(r.length<2)throw'autocommand "'+r+'" not minimum length of 2';if(D[r]===Tt)throw'"'+r+'" is a built-in operator name';n[r]=1,i=x(i,r.length)}return n._maxLength=i,n};var Ot=O(yt,function(t,e){function n(t){return!t||t instanceof X||t instanceof ft}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments);var n=t.options.autoCommands,i=n._maxLength;if(i>0){for(var s="",r=this,o=0;r instanceof Ot&&r.ctrlSeq===r.letter&&i>o;)s=r.letter+s,r=r[k],o+=1;for(;s.length;){if(n.hasOwnProperty(s)){for(var o=1,r=this;o<s.length;o+=1,r=r[k]);return _(r,this).remove(),t[k]=r[k],D[s](s).createLeftOf(t)}s=s.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==k&&this[j]instanceof Ot||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e=t.autoOperatorNames;if(0!==e._maxLength){for(var i=this.letter,s=this[k];s instanceof Ot;s=s[k])i=s.letter+i;for(var r=this[j];r instanceof Ot;r=r[j])i+=r.letter;_(s[j]||this.parent.ends[k],r[k]||this.parent.ends[j]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter});t:for(var o=0,a=s[j]||this.parent.ends[k];o<i.length;o+=1,a=a[j])for(var l=w(e._maxLength,i.length-o);l>0;l-=1){var c=i.slice(o,o+l);if(e.hasOwnProperty(c)){for(var u=0,h=a;l>u;u+=1,h=h[j]){h.italicize(!1);var f=h}var p=kt.hasOwnProperty(c);if(a.ctrlSeq=(p?"\\":"\\operatorname{")+a.ctrlSeq,f.ctrlSeq+=p?" ":"}",Qt.hasOwnProperty(c)&&f[k][k][k].jQ.addClass("mq-last"),n(a[k])||a.jQ.addClass("mq-first"),!n(f[j]))if(f[j]instanceof ht){var d=f[j],m=d.siblingCreated=d.siblingDeleted=function(){d.jQ.toggleClass("mq-after-operator-name",!(d[j]instanceof vt))};m()}else f.jQ.toggleClass("mq-last",!(f[j]instanceof vt));o+=l-1,a=f;continue t}}}}}),kt={},jt=I.p.autoOperatorNames={_maxLength:9},Qt={limsup:1,liminf:1,projlim:1,injlim:1};!function(){for(var t="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),e=0;e<t.length;e+=1)kt[t[e]]=jt[t[e]]=1;for(var n="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),e=0;e<n.length;e+=1)kt[n[e]]=1;for(var i="sin cos tan sec cosec csc cotan cot ctg".split(" "),e=0;e<i.length;e+=1)jt[i[e]]=jt["arc"+i[e]]=jt[i[e]+"h"]=jt["ar"+i[e]+"h"]=jt["arc"+i[e]+"h"]=1;for(var s="gcf hcf lcm proj span".split(" "),e=0;e<s.length;e+=1)jt[s[e]]=1}(),z.autoOperatorNames=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){var r=e[s];if(r.length<2)throw'"'+r+'" not minimum length of 2';n[r]=1,i=x(i,r.length)}return n._maxLength=i,n};var Tt=O(K,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){for(var e=this.ctrlSeq,n=0;n<e.length;n+=1)Ot(e.charAt(n)).createLeftOf(t)},t.parser=function(){for(var t=this.ctrlSeq,e=Z(),n=0;n<t.length;n+=1)Ot(t.charAt(n)).adopt(e,e.ends[j],0);return U.succeed(e.children())}});for(var Ct in jt)jt.hasOwnProperty(Ct)&&(D[Ct]=Tt);D.operatorname=O(G,function(e){e.createLeftOf=t,e.numBlocks=function(){return 1},e.parser=function(){return W.block.map(function(t){return t.children()})}}),D.f=O(Ot,function(t,e){t.init=function(){K.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),D[" "]=D.space=i(Y,"\\ ","&nbsp;"),D["'"]=D.prime=i(Y,"'","&prime;"),D.backslash=i(Y,"\\backslash ","\\"),S["\\"]||(S["\\"]=D.backslash),D.$=i(Y,"\\$","$");var _t=O(K,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}});D["@"]=_t,D["&"]=i(_t,"\\&","&amp;"),D["%"]=i(_t,"\\%","%"),D.alpha=D.beta=D.gamma=D.delta=D.zeta=D.eta=D.theta=D.iota=D.kappa=D.mu=D.nu=D.xi=D.rho=D.sigma=D.tau=D.chi=D.psi=D.omega=O(yt,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),D.phi=i(yt,"\\phi ","&#981;"),D.phiv=D.varphi=i(yt,"\\varphi ","&phi;"),D.epsilon=i(yt,"\\epsilon ","&#1013;"),D.epsiv=D.varepsilon=i(yt,"\\varepsilon ","&epsilon;"),D.piv=D.varpi=i(yt,"\\varpi ","&piv;"),D.sigmaf=D.sigmav=D.varsigma=i(yt,"\\varsigma ","&sigmaf;"),D.thetav=D.vartheta=D.thetasym=i(yt,"\\vartheta ","&thetasym;"),D.upsilon=D.upsi=i(yt,"\\upsilon ","&upsilon;"),D.gammad=D.Gammad=D.digamma=i(yt,"\\digamma ","&#989;"),D.kappav=D.varkappa=i(yt,"\\varkappa ","&#1008;"),D.rhov=D.varrho=i(yt,"\\varrho ","&#1009;"),D.pi=D["π"]=i(_t,"\\pi ","&pi;"),D.lambda=i(_t,"\\lambda ","&lambda;"),D.Upsilon=D.Upsi=D.upsih=D.Upsih=i(K,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),D.Gamma=D.Delta=D.Theta=D.Lambda=D.Xi=D.Pi=D.Sigma=D.Phi=D.Psi=D.Omega=D.forall=O(Y,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}});var Dt=O(G,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=W.parse(this.latex);e.children().adopt(t.parent,t[k],t[j]),t[k]=e.ends[j],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[j][j].siblingCreated&&e.ends[j][j].siblingCreated(t.options,k),e.ends[k][k].siblingCreated&&e.ends[k][k].siblingCreated(t.options,j),t.parent.bubble("reflow")},t.parser=function(){var t=W.parse(this.latex).children();return U.succeed(t)}});D["¹"]=i(Dt,"^1"),D["²"]=i(Dt,"^2"),D["³"]=i(Dt,"^3"),D["¼"]=i(Dt,"\\frac14"),D["½"]=i(Dt,"\\frac12"),D["¾"]=i(Dt,"\\frac34");var St=O(X,function(t){t.init=Y.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){return e!==j?(this.jQ[0].className=!this[k]||this[k]instanceof X||/^[,;:\(\[]$/.test(this[k].ctrlSeq)?"":"mq-binary-operator",this):void 0}});D["+"]=i(St,"+","+"),D["–"]=D["-"]=i(St,"-","&minus;"),D["±"]=D.pm=D.plusmn=D.plusminus=i(St,"\\pm ","&plusmn;"),D.mp=D.mnplus=D.minusplus=i(St,"\\mp ","&#8723;"),S["*"]=D.sdot=D.cdot=i(X,"\\cdot ","&middot;","*");var Lt=O(X,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){return t!==k||this.strict?void e.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}}),Et={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},At={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};D["<"]=D.lt=i(Lt,Et,!0),D[">"]=D.gt=i(Lt,At,!0),D["≤"]=D.le=D.leq=i(Lt,Et,!1),D["≥"]=D.ge=D.geq=i(Lt,At,!1);var Rt=O(X,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){return t[k]instanceof Lt&&t[k].strict?(t[k].swap(!1),void t[k].bubble("reflow")):void e.createLeftOf.apply(this,arguments)}});D["="]=Rt,D["×"]=D.times=i(X,"\\times ","&times;","[x]"),D["÷"]=D.div=D.divide=D.divides=i(X,"\\div ","&divide;","[/]"),S["~"]=D.sim=i(X,"\\sim ","~","~");var It=c(1);for(var zt in It)(function(t,e){"function"==typeof e?(l[t]=function(){return a(),e.apply(this,arguments)},l[t].prototype=e.prototype):l[t]=e})(zt,It[zt])}();</script><style>@font-face{font-family:Symbola;src:url(font/Symbola.eot);src:local("Symbola Regular"),local("Symbola"),url(font/Symbola.woff2) format("woff2"),url(font/Symbola.woff) format("woff"),url(font/Symbola.ttf) format("truetype"),url(font/Symbola.otf) format("opentype"),url(font/Symbola.svg#Symbola) format("svg")}.mq-editable-field,.mq-editable-field .mq-cursor{display:-moz-inline-box;display:inline-block}.mq-editable-field .mq-cursor{border-left:1px solid #000;margin-left:-1px;position:relative;z-index:1;padding:0}.mq-editable-field .mq-cursor.mq-blink{visibility:hidden}.mq-editable-field,.mq-math-mode .mq-editable-field{border:1px solid gray}.mq-editable-field.mq-focused,.mq-math-mode .mq-editable-field.mq-focused{-webkit-box-shadow:#8bd 0 0 1px 2px,inset #6ae 0 0 2px 0;-moz-box-shadow:#8bd 0 0 1px 2px,inset #6ae 0 0 2px 0;box-shadow:#8bd 0 0 1px 2px,inset #6ae 0 0 2px 0;border-color:#709AC0;border-radius:1px}.mq-math-mode .mq-editable-field{margin:1px}.mq-editable-field .mq-latex-command-input{color:inherit;font-family:"Courier New",monospace;border:1px solid gray;padding-right:1px;margin-right:1px;margin-left:2px}.mq-editable-field .mq-latex-command-input.mq-empty{background:0 0}.mq-editable-field .mq-latex-command-input.mq-hasCursor{border-color:ActiveBorder}.mq-editable-field.mq-empty:after,.mq-editable-field.mq-text-mode:after,.mq-math-mode .mq-empty:after{visibility:hidden;content:'c'}.mq-editable-field .mq-cursor:only-child:after,.mq-editable-field .mq-textarea+.mq-cursor:last-child:after{visibility:hidden;content:'c'}.mq-editable-field .mq-text-mode .mq-cursor:only-child:after{content:''}.mq-editable-field.mq-text-mode{overflow-x:auto;overflow-y:hidden}.mq-root-block,.mq-math-mode .mq-root-block{display:-moz-inline-box;display:inline-block;width:100%;padding:2px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;white-space:nowrap;overflow:hidden;vertical-align:middle}.mq-math-mode{font-variant:normal;font-weight:400;font-style:normal;font-size:115%;line-height:1}.mq-math-mode,.mq-math-mode .mq-non-leaf,.mq-math-mode .mq-scaled{display:-moz-inline-box;display:inline-block}.mq-math-mode var,.mq-math-mode .mq-text-mode,.mq-math-mode .mq-nonSymbola{font-family:"Times New Roman",Symbola,serif;line-height:.9}.mq-math-mode *{font-size:inherit;line-height:inherit;margin:0;padding:0;border-color:#000;-webkit-user-select:none;-moz-user-select:none;user-select:none;box-sizing:border-box}.mq-math-mode .mq-empty{background:#ccc}.mq-math-mode .mq-empty.mq-root-block,.mq-math-mode.mq-empty{background:0 0}.mq-math-mode .mq-text-mode{display:inline-block}.mq-math-mode .mq-text-mode.mq-hasCursor{box-shadow:inset darkgray 0 .1em .2em;padding:0 .1em;margin:0 -.1em;min-width:1ex}.mq-math-mode .mq-font{font:1em "Times New Roman",Symbola,serif}.mq-math-mode .mq-font *{font-family:inherit;font-style:inherit}.mq-math-mode b,.mq-math-mode b.mq-font{font-weight:bolder}.mq-math-mode var,.mq-math-mode i,.mq-math-mode i.mq-font{font-style:italic}.mq-math-mode var.mq-f{margin-right:.2em;margin-left:.1em}.mq-math-mode .mq-roman var.mq-f{margin:0}.mq-math-mode big{font-size:200%}.mq-math-mode .mq-roman{font-style:normal}.mq-math-mode .mq-sans-serif{font-family:sans-serif,Symbola,serif}.mq-math-mode .mq-monospace{font-family:monospace,Symbola,serif}.mq-math-mode .mq-overline{border-top:1px solid #000;margin-top:1px}.mq-math-mode .mq-underline{border-bottom:1px solid #000;margin-bottom:1px}.mq-math-mode .mq-binary-operator{padding:0 .2em;display:-moz-inline-box;display:inline-block}.mq-math-mode .mq-supsub{text-align:left;font-size:90%;vertical-align:-.5em}.mq-math-mode .mq-supsub.mq-limit{font-size:80%;vertical-align:-.4em}.mq-math-mode .mq-supsub.mq-sup-only{vertical-align:.5em}.mq-math-mode .mq-supsub.mq-sup-only .mq-sup{display:inline-block;vertical-align:text-bottom}.mq-math-mode .mq-supsub .mq-sup{display:block}.mq-math-mode .mq-supsub .mq-sub{display:block;float:left}.mq-math-mode .mq-supsub.mq-limit .mq-sub{margin-left:-.25em}.mq-math-mode .mq-supsub .mq-binary-operator{padding:0 .1em}.mq-math-mode .mq-supsub .mq-fraction{font-size:70%}.mq-math-mode sup.mq-nthroot{font-size:80%;vertical-align:.8em;margin-right:-.6em;margin-left:.2em;min-width:.5em}.mq-math-mode .mq-paren{padding:0 .1em;vertical-align:top;-webkit-transform-origin:center .06em;-moz-transform-origin:center .06em;-ms-transform-origin:center .06em;-o-transform-origin:center .06em;transform-origin:center .06em}.mq-math-mode .mq-paren.mq-ghost{color:silver}.mq-math-mode .mq-paren+span{margin-top:.1em;margin-bottom:.1em}.mq-math-mode .mq-array{vertical-align:middle;text-align:center}.mq-math-mode .mq-array>span{display:block}.mq-math-mode .mq-operator-name{font-family:Symbola,"Times New Roman",serif;line-height:.9;font-style:normal}.mq-math-mode var.mq-operator-name.mq-first{padding-left:.2em}.mq-math-mode var.mq-operator-name.mq-last,.mq-math-mode .mq-supsub.mq-after-operator-name{padding-right:.2em}.mq-math-mode .mq-fraction{font-size:90%;text-align:center;vertical-align:-.4em;padding:0 .2em}.mq-math-mode .mq-fraction,.mq-math-mode .mq-large-operator,.mq-math-mode x:-moz-any-link{display:-moz-groupbox}.mq-math-mode .mq-fraction,.mq-math-mode .mq-large-operator,.mq-math-mode x:-moz-any-link,.mq-math-mode x:default{display:inline-block}.mq-math-mode .mq-numerator,.mq-math-mode .mq-denominator{display:block}.mq-math-mode .mq-numerator{padding:0 .1em}.mq-math-mode .mq-denominator{border-top:1px solid;float:right;width:100%;padding:.1em}.mq-math-mode .mq-sqrt-prefix{padding-top:0;position:relative;top:.1em;vertical-align:top;-webkit-transform-origin:top;-moz-transform-origin:top;-ms-transform-origin:top;-o-transform-origin:top;transform-origin:top}.mq-math-mode .mq-sqrt-stem{border-top:1px solid;margin-top:1px;padding-left:.15em;padding-right:.2em;margin-right:.1em;padding-top:1px}.mq-math-mode .mq-vector-prefix{display:block;text-align:center;line-height:.25em;margin-bottom:-.1em;font-size:.75em}.mq-math-mode .mq-vector-stem{display:block}.mq-math-mode .mq-large-operator{vertical-align:-.2em;padding:.2em;text-align:center}.mq-math-mode .mq-large-operator .mq-from,.mq-math-mode .mq-large-operator big,.mq-math-mode .mq-large-operator .mq-to{display:block}.mq-math-mode .mq-large-operator .mq-from,.mq-math-mode .mq-large-operator .mq-to{font-size:80%}.mq-math-mode .mq-large-operator .mq-from{float:right;width:100%}.mq-math-mode,.mq-math-mode .mq-editable-field{cursor:text;font-family:Symbola,"Times New Roman",serif}.mq-math-mode .mq-overarrow{border-top:1px solid #000;margin-top:1px;padding-top:.2em}.mq-math-mode .mq-overarrow:before{display:block;position:relative;top:-.34em;font-size:.5em;line-height:0;content:'\27A4';text-align:right}.mq-math-mode .mq-overarrow.mq-arrow-left:before{-moz-transform:scaleX(-1);-o-transform:scaleX(-1);-webkit-transform:scaleX(-1);transform:scaleX(-1);filter:FlipH;-ms-filter:"FlipH"}.mq-math-mode .mq-selection,.mq-editable-field .mq-selection,.mq-math-mode .mq-selection .mq-non-leaf,.mq-editable-field .mq-selection .mq-non-leaf,.mq-math-mode .mq-selection .mq-scaled,.mq-editable-field .mq-selection .mq-scaled{background:#B4D5FE!important;background:Highlight!important;color:HighlightText;border-color:HighlightText}.mq-math-mode .mq-selection .mq-matrixed,.mq-editable-field .mq-selection .mq-matrixed{background:#39F!important}.mq-math-mode .mq-selection .mq-matrixed-container,.mq-editable-field .mq-selection .mq-matrixed-container{filter:progid:DXImageTransform.Microsoft.Chroma(color='#3399FF')!important}.mq-math-mode .mq-selection.mq-blur,.mq-editable-field .mq-selection.mq-blur,.mq-math-mode .mq-selection.mq-blur .mq-non-leaf,.mq-editable-field .mq-selection.mq-blur .mq-non-leaf,.mq-math-mode .mq-selection.mq-blur .mq-scaled,.mq-editable-field .mq-selection.mq-blur .mq-scaled,.mq-math-mode .mq-selection.mq-blur .mq-matrixed,.mq-editable-field .mq-selection.mq-blur .mq-matrixed{background:#D4D4D4!important;color:#000;border-color:#000}.mq-math-mode .mq-selection.mq-blur .mq-matrixed-container,.mq-editable-field .mq-selection.mq-blur .mq-matrixed-container{filter:progid:DXImageTransform.Microsoft.Chroma(color='#D4D4D4')!important}.mq-editable-field .mq-textarea,.mq-math-mode .mq-textarea{position:relative;-webkit-user-select:text;-moz-user-select:text;user-select:text}.mq-editable-field .mq-textarea *,.mq-math-mode .mq-textarea *,.mq-editable-field .mq-selectable,.mq-math-mode .mq-selectable{-webkit-user-select:text;-moz-user-select:text;user-select:text;position:absolute;clip:rect(1em 1em 1em 1em);-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);-o-transform:scale(0);transform:scale(0);resize:none;width:1px;height:1px}.mq-math-mode .mq-matrixed{background:#fff;display:-moz-inline-box;display:inline-block}.mq-math-mode .mq-matrixed-container{filter:progid:DXImageTransform.Microsoft.Chroma(color='white');margin-top:-.1em}</style><dom-module id=input-math><style type=css>:host{box-sizing:border-box;display:block}#editor{width:100%}ul{display:inline-block;list-style:none;margin:.5em 1em 0 0;padding:0;font-size:.65em}ul:last-of-type{margin-right:0}li{float:left}li,button{vertical-align:middle}button{text-align:center;min-width:3em;height:3em}button>span{text-transform:none}.big{font-size:1.8em;vertical-align:middle}.sup{vertical-align:super}.sup,.sub{font-size:smaller}.sub{vertical-align:sub}.n-sup{position:relative}.n-sup::before{content:'n';vertical-align:super;font-size:.7em;position:absolute;top:0;left:0;-webkit-transform:translate(-40%,-40%);transform:translate(-40%,-40%)}</style><template><div id=controls><template is=dom-repeat items=[[symbols]] as=group><ul class=button-group><template is=dom-repeat items=[[group]]><li><button on-tap=cmd type=button class="cmd button"><span class$=[[item.className]]>[[item.name]]</span></button></li></template></ul></template></div></template></dom-module><script>"use strict";var __extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},__decorate=this&&this.__decorate||function(t,e,a,o){var i,n=arguments.length,r=3>n?e:null===o?o=Object.getOwnPropertyDescriptor(e,a):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,a,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(r=(3>n?i(r):n>3?i(e,a,r):i(e,a))||r);return n>3&&r&&Object.defineProperty(e,a,r),r},__metadata=this&&this.__metadata||function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},InputMath=function(t){function e(){t.apply(this,arguments),this._observerLocked=!1,this._freezeHistory=!1}return __extends(e,t),e.prototype.created=function(){var t=this._editor=document.createElement("div");t.id="editor",t.classList.add(this.is),this._mathField=MathQuill.getInterface(2).MathField(t,{spaceBehavesLikeTab:!0,handlers:{edit:this._updateValue.bind(this)}})},e.prototype.ready=function(){this.insertBefore(this._editor,this.$.controls)},e.prototype.cmd=function(t){this._mathField.cmd(t.model.item.cmd).focus()},e.prototype.undo=function(){this._history&&this._history.length>0&&(this._freezeHistory=!0,this.value=this._history.pop(),this._freezeHistory=!1)},e.prototype.valueChanged=function(t,e){this._updateHistory(e),this._observerLocked||(this._mathField.select().write(t),""===this._mathField.latex()&&this.undo())},e.prototype.symbolsChanged=function(t){t&&(this.symbols=t.split(",").map(function(t){return e["SYMBOLS_"+t.toUpperCase()]||[]}))},e.prototype.keyShortcuts=function(t){t.ctrlKey&&90===t.keyCode&&this.undo()},e.prototype._updateValue=function(){this._observerLocked=!0,this.value=this._mathField.latex(),this._observerLocked=!1},e.prototype._updateHistory=function(t){this._history||(this._history=[]),this._freezeHistory||null==t||(this._history.push(t),this._history.length>e.HISTORY_SIZE&&this._history.shift())},e.HISTORY_SIZE=20,e.SYMBOLS_BASIC=[{cmd:"\\sqrt",name:"√"},{cmd:"\\nthroot",name:"√",className:"n-sup"},{cmd:"\\int",name:"∫"},{cmd:"^",name:"n",className:"sup"},{cmd:"_",name:"n",className:"sub"},{cmd:"\\rightarrow",name:"→"},{cmd:"\\infty",name:"∞"},{cmd:"\\neq",name:"≠"},{cmd:"\\degree",name:"°"},{cmd:"\\div",name:"÷"}],e.SYMBOLS_GREEK=[{cmd:"\\lambda",name:"λ"},{cmd:"\\pi",name:"π"},{cmd:"\\mu",name:"μ"},{cmd:"\\sum",name:"Σ"},{cmd:"\\alpha",name:"α"},{cmd:"\\beta",name:"β"},{cmd:"\\gamma",name:"γ"},{cmd:"\\delta",name:"ᵟ",className:"big"},{cmd:"\\Delta",name:"Δ"}],e.SYMBOLS_PHYSICS=[{cmd:"\\ohm",name:"Ω"},{cmd:"\\phi",name:"ᶲ",className:"big"}],__decorate([property({type:String,value:"",reflectToAttribute:!0}),__metadata("design:type",String)],e.prototype,"value",void 0),__decorate([property({type:Array,value:function(){return[e.SYMBOLS_BASIC,e.SYMBOLS_GREEK]}}),__metadata("design:type",Array)],e.prototype,"symbols",void 0),__decorate([property({type:String,value:""}),__metadata("design:type",String)],e.prototype,"showSymbols",void 0),__decorate([observe("value"),__metadata("design:type",Function),__metadata("design:paramtypes",[String,String]),__metadata("design:returntype",void 0)],e.prototype,"valueChanged",null),__decorate([observe("showSymbols"),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",void 0)],e.prototype,"symbolsChanged",null),__decorate([listen("keydown"),__metadata("design:type",Function),__metadata("design:paramtypes",[KeyboardEvent]),__metadata("design:returntype",void 0)],e.prototype,"keyShortcuts",null),e=__decorate([component("input-math"),__metadata("design:paramtypes",[])],e)}(polymer.Base);InputMath.register();</script>